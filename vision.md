# Техническое видение проекта RL-Interception

> Проект для анализа и сравнения RL алгоритмов на задаче перехвата цели в среде с препятствиями.
> Принцип разработки: **KISS (Keep It Simple, Stupid)** - максимальная простота для проверки идеи.

---

## 1. Технологии

### Основной стек
- **Python 3.10+** - основной язык разработки
- **Gymnasium** - стандартная библиотека для RL-сред (наследник OpenAI Gym)
- **CleanRL** - чистые однофайловые реализации RL алгоритмов (PPO, SAC, TD3, DQN)
  - Каждый алгоритм в отдельном файле для полного контроля и понимания
  - Легко адаптировать под специфику задачи

### Визуализация и анализ
- **Matplotlib** - построение графиков, траекторий, анимаций
- **NumPy** - численные вычисления, работа с массивами

### Конфигурация и данные
- **YAML** - простые человекочитаемые конфигурационные файлы
- **Python dataclasses** - типизированные структуры данных для конфигураций

### Опционально
- **Pandas** - обработка результатов экспериментов (если потребуется)

### Что сознательно НЕ используем (для простоты MVP)
- ❌ Ray/RLlib - избыточная сложность для начального этапа
- ❌ Weights & Biases / MLflow - пока без внешних сервисов мониторинга
- ❌ Docker - не нужен на этапе разработки
- ❌ FastAPI/веб-интерфейс - консольное приложение достаточно
- ❌ Базы данных - файловое хранение результатов

### Зависимости
```txt
gymnasium>=0.29.0
torch>=2.0.0
matplotlib>=3.7.0
numpy>=1.24.0
pyyaml>=6.0
```

> **Примечание:** CleanRL алгоритмы будут храниться в папке `algorithms/` как отдельные модули

---

## 2. Принципы разработки

### KISS (Keep It Simple, Stupid)
- Минимум абстракций, максимум конкретики
- Сначала работающее решение, потом оптимизация
- Код должен быть понятен через 3 месяца
- Явное лучше неявного

### Итеративная разработка
**Версия 0.1** (1-2 дня):
- Базовая среда с препятствиями
- Один алгоритм (PPO)
- Простая визуализация траектории

**Версия 0.2** (2-3 дня):
- Добавить 2-3 алгоритма (SAC, TD3, DQN)
- Сравнительные графики
- Базовые метрики

**Версия 0.3** (2-3 дня):
- Батчевое тестирование нескольких сценариев
- Расширенные метрики и анализ
- Автоматическое сохранение результатов

### YAGNI (You Aren't Gonna Need It)
- ❌ Не делаем универсальный фреймворк для всех задач RL
- ❌ Не делаем GUI, если хватит matplotlib
- ❌ Не делаем распределенное обучение
- ❌ Не делаем абстрактные базовые классы "на будущее"
- ✅ Делаем конкретное решение конкретной задачи

### Воспроизводимость результатов
- Фиксация всех random seeds (Python, NumPy, PyTorch, Gymnasium)
- Сохранение полных конфигураций экспериментов
- Версионирование результатов (timestamp + config hash)

### Качество кода
- Простой читаемый код без "умных" паттернов
- Комментарии только где действительно нужно (не дублируем код словами)
- Type hints для публичных функций
- **Без юнит-тестов на этапе MVP** - фокус на быстром прототипе

### Git workflow
- Коммиты по логическим частям функциональности
- Простой linear history (без сложных merge стратегий)

---

## 3. Структура проекта

```
rl-interception/
├── configs/                    # YAML конфигурации экспериментов
│   ├── env_default.yaml       # Параметры среды по умолчанию
│   ├── ppo_config.yaml        # Гиперпараметры для PPO
│   ├── sac_config.yaml        # Гиперпараметры для SAC
│   └── experiment_01.yaml     # Пример полной конфигурации эксперимента
│
├── algorithms/                 # RL алгоритмы из CleanRL (адаптированные)
│   ├── ppo.py                 # PPO алгоритм
│   ├── sac.py                 # SAC алгоритм
│   ├── td3.py                 # TD3 алгоритм
│   └── dqn.py                 # DQN алгоритм
│
├── environment/                # Среда перехвата с препятствиями
│   ├── interception_env.py    # Основной класс Gymnasium среды
│   └── obstacles.py           # Генерация и проверка препятствий
│
├── visualization/              # Визуализация и анализ
│   ├── plotter.py             # Графики траекторий, метрик
│   └── animator.py            # Анимация движения агента
│
├── experiments/                # Скрипты для запуска экспериментов
│   ├── train.py               # Обучение одного алгоритма
│   ├── compare.py             # Сравнение нескольких алгоритмов
│   └── evaluate.py            # Оценка обученной модели
│
├── results/                    # Результаты экспериментов (в .gitignore)
│   ├── models/                # Сохраненные веса моделей (.pth файлы)
│   ├── logs/                  # Логи обучения (CSV/JSON)
│   └── plots/                 # Графики и визуализации (PNG/PDF)
│
├── utils/                      # Утилиты
│   ├── config_loader.py       # Загрузка и валидация YAML конфигов
│   └── seed.py                # Управление random seeds
│
├── tests/                      # Тесты (добавятся позже при необходимости)
│
├── requirements.txt            # Зависимости Python
├── .gitignore                 # Исключения для git
├── README.md                  # Инструкция по установке и запуску
├── idea.md                    # Описание идеи проекта
├── problem.md                 # Формальная постановка задачи
└── vision.md                  # Техническое видение (этот файл)
```

### Ключевые особенности структуры

**Простота навигации:**
- Плоская иерархия - максимум 2 уровня вложенности
- Понятные названия папок и файлов
- Один модуль = одна задача

**Разделение ответственности:**
- `algorithms/` - изолированные реализации RL алгоритмов
- `environment/` - только логика среды
- `visualization/` - только визуализация
- `experiments/` - точки входа для пользователя

**Работа с результатами:**
- `results/` полностью в `.gitignore`
- Внутри результатов - структура по типам файлов
- Легко очистить и пересоздать

**Конфигурации:**
- Все параметры в YAML файлах
- Разделение на конфиги среды и алгоритмов
- Композиция конфигов для экспериментов

---

## 4. Архитектура проекта

### Основные компоненты и взаимодействие

```
┌─────────────────────────────────────────────────────────┐
│                   Эксперимент (train.py)                 │
│  ┌─────────────┐     ┌──────────────┐    ┌───────────┐ │
│  │ Config YAML │────▶│ Config Loader│───▶│ Seed Init │ │
│  └─────────────┘     └──────────────┘    └───────────┘ │
└────────────┬────────────────────────────────────────────┘
             │
             ▼
┌─────────────────────────┐      ┌──────────────────────┐
│  InterceptionEnv        │◀────▶│   RL Algorithm       │
│  (Gymnasium)            │      │   (PPO/SAC/TD3/DQN)  │
│                         │      │                      │
│  - reset()              │      │  - __init__()        │
│  - step(action)         │      │  - train()           │
│  - render()             │      │  - predict()         │
│  - Obstacles logic      │      │  - save_model()      │
└─────────────────────────┘      └──────────────────────┘
             │                              │
             │                              ▼
             │                   ┌──────────────────────┐
             │                   │   Results Storage    │
             │                   │  - models/*.pth      │
             │                   │  - logs/*.json       │
             │                   └──────────────────────┘
             ▼
┌─────────────────────────┐
│   Visualization         │
│  - plot_trajectory()    │
│  - plot_metrics()       │
│  - animate_episode()    │
└─────────────────────────┘
```

### Поток работы

**1. Обучение (train.py):**
```
Config YAML → Создание среды → Инициализация алгоритма → 
→ Цикл обучения → Сохранение модели → Визуализация результатов
```

**2. Сравнение (compare.py):**
```
Несколько config → Параллельное/последовательное обучение → 
→ Сбор метрик → Сравнительные графики
```

**3. Оценка (evaluate.py):**
```
Загрузка модели → Тестирование на сценариях → 
→ Визуализация траекторий → Расчет финальных метрик
```

### Ключевые принципы архитектуры

**Изоляция компонентов:**
- Среда ничего не знает об алгоритмах
- Алгоритмы работают со стандартным Gymnasium интерфейсом
- Визуализация независима от обучения

**Простота интерфейсов:**
- Среда: `reset()`, `step()`, `render()` - стандарт Gymnasium
- Алгоритм: `train()`, `predict()`, `save()` - минимальный API
- Конфиги: обычные словари Python из YAML

**Без избыточных абстракций:**
- Никаких абстрактных базовых классов
- Никаких фабрик и сложных паттернов проектирования
- Прямые импорты и вызовы функций

---

